<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Система тестування</title>
    <style>
        /* Основні стилі */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            color: #333;
        }

        /* Стилі для форм */
        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        /* Кнопки */
        .btn-primary {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        .btn-success {
            background-color: #2196F3;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn-success:hover {
            background-color: #0b7dda;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        .btn-cancel:hover {
            background-color: #da190b;
        }

        .btn-delete {
            background-color: #ff9800;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-delete:hover {
            background-color: #e68a00;
        }

        /* Бічна панель */
        .sidebar {
            width: 250px;
            background-color: #333;
            color: white;
            position: fixed;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .user-info {
            margin-bottom: 30px;
            text-align: center;
        }

        .menu {
            list-style: none;
            padding: 0;
        }

        .menu li {
            margin-bottom: 10px;
        }

        .menu a {
            color: white;
            text-decoration: none;
            display: block;
            padding: 10px;
            border-radius: 4px;
        }

        .menu a:hover, .menu a.active {
            background-color: #4CAF50;
        }

        /* Питання тесту */
        .question {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .answer {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .answer input[type="text"] {
            flex-grow: 1;
            margin-right: 10px;
        }

        /* Таймер */
        .timer {
            font-size: 24px;
            font-weight: bold;
            color: #f44336;
            text-align: right;
            margin-bottom: 20px;
        }

        /* Реєстрація */
        .registration-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-btn {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .student-btn {
            background-color: #4CAF50;
            color: white;
        }

        .teacher-btn {
            background-color: #2196F3;
            color: white;
        }

        .option-btn:hover {
            opacity: 0.9;
        }

        .registration-form {
            display: none;
            margin-top: 20px;
            text-align: left;
        }

        .submit-btn {
            background-color: #FF5722;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background-color: #E64A19;
        }

        .verification-code {
            display: none;
        }

        .back-btn {
            background-color: #9E9E9E;
            color: white;
            margin-top: 10px;
        }

        /* Адаптивність */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Головний контейнер, який буде мінятися в залежності від сторінки -->
    <div id="app-container">
        <!-- Тут буде відображатися контент -->
    </div>

    <script>
        // Глобальні змінні
        let currentPage = 'register';
        let currentUser = null;
        let tests = JSON.parse(localStorage.getItem('tests')) || [];
        let students = JSON.parse(localStorage.getItem('students')) || [];
        let testResults = JSON.parse(localStorage.getItem('testResults')) || [];

        // Функції для роботи з DOM
        function renderPage() {
            const container = document.getElementById('app-container');
            
            switch(currentPage) {
                case 'register':
                    renderRegisterPage(container);
                    break;
                case 'teacher_dashboard':
                    renderTeacherDashboard(container);
                    break;
                case 'student_dashboard':
                    renderStudentDashboard(container);
                    break;
                case 'test_creation':
                    renderTestCreation(container);
                    break;
                case 'test_pass':
                    renderTestPass(container);
                    break;
                case 'test_analytics':
                    renderTestAnalytics(container);
                    break;
                default:
                    renderRegisterPage(container);
            }
        }

        // Сторінка реєстрації
        function renderRegisterPage(container) {
            container.innerHTML = `
                <div class="container">
                    <h1>Система тестування</h1>
                    
                    <div class="registration-options">
                        <button class="option-btn student-btn" onclick="showRegistrationForm('student')">Реєстрація учня</button>
                        <button class="option-btn teacher-btn" onclick="showRegistrationForm('teacher')">Реєстрація вчителя</button>
                    </div>
                    
                    <div id="student-form" class="registration-form">
                        <h2>Реєстрація учня</h2>
                        <div class="form-group">
                            <label for="student-email">Електронна адреса:</label>
                            <input type="email" id="student-email" required>
                        </div>
                        <div class="form-group">
                            <label for="student-password">Пароль:</label>
                            <input type="password" id="student-password" required>
                        </div>
                        <button class="submit-btn" onclick="sendVerificationCode('student')">Надіслати код підтвердження</button>
                        <button class="submit-btn back-btn" onclick="hideRegistrationForms()">Назад</button>
                        
                        <div id="student-verification" class="verification-code">
                            <div class="form-group">
                                <label for="student-code">Код підтвердження:</label>
                                <input type="text" id="student-code" required>
                            </div>
                            <button class="submit-btn" onclick="verifyCode('student')">Підтвердити</button>
                        </div>
                    </div>
                    
                    <div id="teacher-form" class="registration-form">
                        <h2>Реєстрація вчителя</h2>
                        <div class="form-group">
                            <label for="teacher-email">Електронна адреса:</label>
                            <input type="email" id="teacher-email" required>
                        </div>
                        <div class="form-group">
                            <label for="teacher-password">Пароль:</label>
                            <input type="password" id="teacher-password" required>
                        </div>
                        <button class="submit-btn" onclick="sendVerificationCode('teacher')">Надіслати код підтвердження</button>
                        <button class="submit-btn back-btn" onclick="hideRegistrationForms()">Назад</button>
                        
                        <div id="teacher-verification" class="verification-code">
                            <div class="form-group">
                                <label for="teacher-code">Код підтвердження:</label>
                                <input type="text" id="teacher-code" required>
                            </div>
                            <button class="submit-btn" onclick="verifyCode('teacher')">Підтвердити</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Сторінка вчителя
        function renderTeacherDashboard(container) {
            const teacherTests = tests.filter(test => test.teacherEmail === currentUser.email);
            
            container.innerHTML = `
                <div class="sidebar">
                    <div class="user-info">
                        <h3>Вчитель</h3>
                        <p>${currentUser.email}</p>
                    </div>
                    <ul class="menu">
                        <li><a href="#" class="active" onclick="showTeacherSection('create-test')">Створити тестування</a></li>
                        <li><a href="#" onclick="showTeacherSection('analytics')">Аналітика тестувань</a></li>
                        <li><a href="#" onclick="showTeacherSection('students')">Учні</a></li>
                        <li><a href="#" onclick="logout()">Вийти</a></li>
                    </ul>
                </div>

                <div class="main-content">
                    <div id="create-test" class="content-section">
                        <h2>Створити тестування</h2>
                        <button class="btn-primary" onclick="goToTestCreation()">Нове тестування</button>
                        
                        <h3>Мої тестування</h3>
                        <div id="teacher-tests-list" class="tests-list">
                            ${teacherTests.length > 0 ? 
                                teacherTests.map(test => `
                                    <div class="test-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                                        <h4>${test.name}</h4>
                                        <p>Код доступу: ${test.code}</p>
                                        <p>Кількість питань: ${test.questions.length}</p>
                                        <p>Посилання: <a href="#" onclick="startTestAsTeacher('${test.id}')">Перейти до тесту</a></p>
                                    </div>
                                `).join('') : 
                                '<p>Ви ще не створили жодного тесту.</p>'}
                        </div>
                    </div>

                    <div id="analytics" class="content-section" style="display:none;">
                        <h2>Аналітика тестувань</h2>
                        <div id="analytics-content">
                            ${renderTestAnalyticsContent()}
                        </div>
                    </div>

                    <div id="students" class="content-section" style="display:none;">
                        <h2>Управління учнями</h2>
                        <div class="form-group">
                            <input type="email" id="student-email-to-add" placeholder="Email учня">
                            <button class="btn-primary" onclick="addStudent()">Додати учня</button>
                        </div>
                        
                        <h3>Список учнів</h3>
                        <div id="students-list">
                            ${students.length > 0 ? 
                                students.map(student => `
                                    <div class="student-item" style="margin-bottom: 10px; padding: 10px; background-color: #f9f9f9; border-radius: 4px;">
                                        ${student.email}
                                        <button class="btn-delete" onclick="removeStudent('${student.email}')" style="float: right;">Видалити</button>
                                    </div>
                                `).join('') : 
                                '<p>У вас немає доданих учнів.</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // Сторінка учня
        function renderStudentDashboard(container) {
            const studentTests = getStudentTests();
            
            container.innerHTML = `
                <div class="sidebar">
                    <div class="user-info">
                        <h3>Учень</h3>
                        <p>${currentUser.email}</p>
                    </div>
                    <ul class="menu">
                        <li><a href="#" class="active" onclick="showStudentSection('my-tests')">Ваші тестування</a></li>
                        <li><a href="#" onclick="logout()">Вийти</a></li>
                    </ul>
                </div>

                <div class="main-content">
                    <div id="my-tests" class="content-section">
                        <h2>Ваші тестування</h2>
                        <div id="student-tests-list" class="tests-list">
                            ${studentTests.length > 0 ? 
                                studentTests.map(test => `
                                    <div class="test-item" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                                        <h4>${test.name}</h4>
                                        <p>Вчитель: ${test.teacherEmail}</p>
                                        <button class="btn-primary" onclick="startTest('${test.id}')">Почати тестування</button>
                                    </div>
                                `).join('') : 
                                '<p>У вас немає доступних тестів.</p>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // Сторінка створення тесту
        function renderTestCreation(container) {
            container.innerHTML = `
                <div class="container">
                    <h1>Створення тесту</h1>
                    
                    <div class="form-group">
                        <label for="test-name">Назва тесту:</label>
                        <input type="text" id="test-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="test-code">Код доступу:</label>
                        <input type="text" id="test-code" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="test-timer">Таймер (хвилини, 0 - без таймера):</label>
                        <input type="number" id="test-timer" min="0" value="0">
                    </div>
                    
                    <h2>Питання тесту</h2>
                    <div id="questions-container">
                        <!-- Тут будуть додаватися питання -->
                    </div>
                    
                    <button class="btn-primary" onclick="addQuestion('single')">Додати питання з однією відповіддю</button>
                    <button class="btn-primary" onclick="addQuestion('multiple')">Додати питання з кількома відповідями</button>
                    <button class="btn-primary" onclick="addQuestion('matching')">Додати питання на встановлення відповідності</button>
                    <button class="btn-primary" onclick="addQuestion('fill')">Додати питання з заповненням пропуску</button>
                    
                    <div class="actions" style="margin-top: 20px;">
                        <button class="btn-success" onclick="saveTest()">Зберегти тест</button>
                        <button class="btn-cancel" onclick="goToTeacherDashboard()">Скасувати</button>
                    </div>
                </div>
            `;
        }

        // Сторінка проходження тесту
        function renderTestPass(container) {
            const test = getCurrentTest();
            if (!test) {
                goToStudentDashboard();
                return;
            }

            container.innerHTML = `
                <div class="container">
                    <h1 id="test-title">${test.name}</h1>
                    ${test.timer > 0 ? `<div id="timer" class="timer">Час: ${test.timer}:00</div>` : ''}
                    
                    <div id="test-form">
                        ${renderTestQuestions(test)}
                    </div>
                    
                    <button id="submit-btn" class="btn-primary" onclick="submitTest()">Завершити тестування</button>
                </div>
            `;

            if (test.timer > 0) {
                startTimer(test.timer);
            }
        }

        // Допоміжні функції для рендерингу
        function renderTestAnalyticsContent() {
            const teacherTests = tests.filter(test => test.teacherEmail === currentUser.email);
            
            if (teacherTests.length === 0) {
                return '<p>Немає даних для аналітики.</p>';
            }
            
            return teacherTests.map(test => {
                const results = testResults.filter(result => result.testId === test.id);
                
                return `
                    <div class="test-analytics" style="margin-bottom: 30px; padding: 15px; background-color: #f9f9f9; border-radius: 4px;">
                        <h3>${test.name} (Код: ${test.code})</h3>
                        ${results.length > 0 ? 
                            `<table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="background-color: #333; color: white;">
                                        <th style="padding: 10px; text-align: left;">Учень</th>
                                        <th style="padding: 10px; text-align: left;">Результат</th>
                                        <th style="padding: 10px; text-align: left;">Дата</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${results.map(result => `
                                        <tr style="border-bottom: 1px solid #ddd;">
                                            <td style="padding: 10px;">${result.studentEmail}</td>
                                            <td style="padding: 10px;">${result.score} з ${result.maxScore} (${Math.round((result.score / result.maxScore) * 100)}%)</td>
                                            <td style="padding: 10px;">${new Date(result.date).toLocaleString()}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>` : 
                            '<p>Ще немає результатів для цього тесту.</p>'}
                    </div>
                `;
            }).join('');
        }

        function renderTestQuestions(test) {
            return test.questions.map((question, qIndex) => {
                let questionHtml = `
                    <div class="question" style="margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                        <h3>Питання ${qIndex + 1}: ${question.text}</h3>
                        <p>Бали: ${question.points}</p>
                `;

                switch(question.type) {
                    case 'single':
                        questionHtml += `
                            <div class="answers">
                                ${question.answers.map((answer, aIndex) => `
                                    <div class="answer" style="margin-bottom: 10px;">
                                        <input type="radio" name="question-${qIndex}" id="question-${qIndex}-answer-${aIndex}" value="${aIndex}">
                                        <label for="question-${qIndex}-answer-${aIndex}">${answer.text}</label>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;
                    case 'multiple':
                        questionHtml += `
                            <div class="answers">
                                ${question.answers.map((answer, aIndex) => `
                                    <div class="answer" style="margin-bottom: 10px;">
                                        <input type="checkbox" id="question-${qIndex}-answer-${aIndex}" value="${aIndex}">
                                        <label for="question-${qIndex}-answer-${aIndex}">${answer.text}</label>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;
                    case 'matching':
                        questionHtml += `
                            <div class="matching" style="display: flex; justify-content: space-between;">
                                <div style="width: 45%;">
                                    ${question.leftItems.map((item, i) => `
                                        <div style="margin-bottom: 10px;">
                                            <span>${i + 1}. ${item}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                <div style="width: 45%;">
                                    ${question.rightItems.map((item, i) => `
                                        <div style="margin-bottom: 10px;">
                                            <select id="question-${qIndex}-match-${i}" style="width: 100%;">
                                                <option value="">Оберіть відповідність</option>
                                                ${question.leftItems.map((_, j) => `
                                                    <option value="${j}">${j + 1}</option>
                                                `).join('')}
                                            </select>
                                            <span>${item}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                        break;
                    case 'fill':
                        questionHtml += `
                            <div class="fill-blanks">
                                <p>${question.textWithBlanks.replace(/_/g, '<input type="text" style="border-bottom: 1px solid #333; border-top: none; border-left: none; border-right: none; width: 100px;">')}</p>
                            </div>
                        `;
                        break;
                }

                questionHtml += `</div>`;
                return questionHtml;
            }).join('');
        }

        // Функції для роботи з тестами
        function getCurrentTest() {
            const testId = localStorage.getItem('currentTestId');
            return tests.find(test => test.id === testId);
        }

        function getStudentTests() {
            return tests.filter(test => 
                test.assignedStudents && test.assignedStudents.includes(currentUser.email)
            );
        }

        function addQuestion(type) {
            const container = document.getElementById('questions-container');
            const questionId = Date.now();
            
            let questionHtml = '';
            
            switch(type) {
                case 'single':
                    questionHtml = `
                        <div class="question" id="question-${questionId}" data-type="single" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                            <div class="question-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0;">Питання з однією правильною відповіддю</h3>
                                <button class="btn-delete" onclick="removeQuestion('${questionId}')">Видалити</button>
                            </div>
                            <div class="form-group">
                                <label>Текст питання:</label>
                                <input type="text" class="question-text" required>
                            </div>
                            <div class="form-group">
                                <label>Бали за питання:</label>
                                <input type="number" class="question-points" min="1" value="1" required>
                            </div>
                            <div class="answers-container" id="answers-${questionId}">
                                <div class="answer" style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <input type="text" class="answer-text" placeholder="Варіант відповіді" required style="flex-grow: 1; margin-right: 10px;">
                                    <input type="radio" name="correct-${questionId}" value="0" required>
                                    <label style="margin-right: 10px;">Правильна</label>
                                    <button class="btn-delete" onclick="removeAnswer(this)">Видалити</button>
                                </div>
                            </div>
                            <button class="btn-primary" onclick="addAnswer('${questionId}')" style="margin-top: 10px;">Додати варіант відповіді</button>
                        </div>
                    `;
                    break;
                case 'multiple':
                    questionHtml = `
                        <div class="question" id="question-${questionId}" data-type="multiple" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                            <div class="question-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0;">Питання з кількома правильними відповідями</h3>
                                <button class="btn-delete" onclick="removeQuestion('${questionId}')">Видалити</button>
                            </div>
                            <div class="form-group">
                                <label>Текст питання:</label>
                                <input type="text" class="question-text" required>
                            </div>
                            <div class="form-group">
                                <label>Бали за питання:</label>
                                <input type="number" class="question-points" min="1" value="1" required>
                            </div>
                            <div class="answers-container" id="answers-${questionId}">
                                <div class="answer" style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <input type="text" class="answer-text" placeholder="Варіант відповіді" required style="flex-grow: 1; margin-right: 10px;">
                                    <input type="checkbox" class="correct-answer" value="0">
                                    <label style="margin-right: 10px;">Правильна</label>
                                    <button class="btn-delete" onclick="removeAnswer(this)">Видалити</button>
                                </div>
                            </div>
                            <button class="btn-primary" onclick="addAnswer('${questionId}')" style="margin-top: 10px;">Додати варіант відповіді</button>
                        </div>
                    `;
                    break;
                case 'matching':
                    questionHtml = `
                        <div class="question" id="question-${questionId}" data-type="matching" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                            <div class="question-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0;">Питання на встановлення відповідності</h3>
                                <button class="btn-delete" onclick="removeQuestion('${questionId}')">Видалити</button>
                            </div>
                            <div class="form-group">
                                <label>Текст питання:</label>
                                <input type="text" class="question-text" required>
                            </div>
                            <div class="form-group">
                                <label>Бали за питання:</label>
                                <input type="number" class="question-points" min="1" value="1" required>
                            </div>
                            <div class="form-group">
                                <label>Кількість пар:</label>
                                <input type="number" class="pairs-count" min="2" max="10" value="3" required>
                            </div>
                            <div class="pairs-container" id="pairs-${questionId}" style="display: flex; justify-content: space-between;">
                                <div style="width: 45%;">
                                    <h4>Ліва колонка</h4>
                                    <div id="left-items-${questionId}">
                                        <input type="text" class="left-item" placeholder="Елемент 1" required style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" class="left-item" placeholder="Елемент 2" required style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" class="left-item" placeholder="Елемент 3" required style="width: 100%; margin-bottom: 5px;">
                                    </div>
                                </div>
                                <div style="width: 45%;">
                                    <h4>Права колонка</h4>
                                    <div id="right-items-${questionId}">
                                        <input type="text" class="right-item" placeholder="Елемент A" required style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" class="right-item" placeholder="Елемент B" required style="width: 100%; margin-bottom: 5px;">
                                        <input type="text" class="right-item" placeholder="Елемент C" required style="width: 100%; margin-bottom: 5px;">
                                    </div>
                                </div>
                            </div>
                            <button class="btn-primary" onclick="updatePairs('${questionId}')" style="margin-top: 10px;">Оновити кількість пар</button>
                        </div>
                    `;
                    break;
                case 'fill':
                    questionHtml = `
                        <div class="question" id="question-${questionId}" data-type="fill" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
                            <div class="question-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h3 style="margin: 0;">Питання з заповненням пропуску</h3>
                                <button class="btn-delete" onclick="removeQuestion('${questionId}')">Видалити</button>
                            </div>
                            <div class="form-group">
                                <label>Текст питання (використовуйте _ для пропусків):</label>
                                <textarea class="question-text-with-blanks" required style="width: 100%; height: 100px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Бали за питання:</label>
                                <input type="number" class="question-points" min="1" value="1" required>
                            </div>
                            <div class="form-group">
                                <label>Правильні відповіді (через кому):</label>
                                <input type="text" class="correct-answers" placeholder="відповідь1, відповідь2, ..." required>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            container.insertAdjacentHTML('beforeend', questionHtml);
        }

        function saveTest() {
            const testName = document.getElementById('test-name').value;
            const testCode = document.getElementById('test-code').value;
            const testTimer = parseInt(document.getElementById('test-timer').value) || 0;
            
            if (!testName || !testCode) {
                alert('Будь ласка, заповніть назву тесту та код доступу');
                return;
            }
            
            const questions = [];
            const questionElements = document.querySelectorAll('.question');
            
            questionElements.forEach(questionEl => {
                const type = questionEl.dataset.type;
                const text = questionEl.querySelector('.question-text') ? 
                    questionEl.querySelector('.question-text').value : 
                    questionEl.querySelector('.question-text-with-blanks').value;
                const points = parseInt(questionEl.querySelector('.question-points').value);
                
                let questionData = {
                    type: type,
                    text: text,
                    points: points
                };
                
                switch(type) {
                    case 'single':
                    case 'multiple':
                        const answers = [];
                        const answerElements = questionEl.querySelectorAll('.answer');
                        
                        answerElements.forEach((answerEl, index) => {
                            answers.push({
                                text: answerEl.querySelector('.answer-text').value,
                                isCorrect: answerEl.querySelector('input[type="radio"], input[type="checkbox"]').checked
                            });
                        });
                        
                        questionData.answers = answers;
                        break;
                        
                    case 'matching':
                        const leftItems = [];
                        const rightItems = [];
                        
                        questionEl.querySelectorAll('.left-item').forEach(item => {
                            leftItems.push(item.value);
                        });
                        
                        questionEl.querySelectorAll('.right-item').forEach(item => {
                            rightItems.push(item.value);
                        });
                        
                        questionData.leftItems = leftItems;
                        questionData.rightItems = rightItems;
                        break;
                        
                    case 'fill':
                        questionData.textWithBlanks = questionEl.querySelector('.question-text-with-blanks').value;
                        questionData.correctAnswers = questionEl.querySelector('.correct-answers').value.split(',').map(a => a.trim());
                        break;
                }
                
                questions.push(questionData);
            });
            
            if (questions.length === 0) {
                alert('Будь ласка, додайте хоча б одне питання');
                return;
            }
            
            const testId = localStorage.getItem('editingTestId') || `test_${Date.now()}`;
            const existingTestIndex = tests.findIndex(t => t.id === testId);
            
            const test = {
                id: testId,
                name: testName,
                code: testCode,
                timer: testTimer,
                questions: questions,
                teacherEmail: currentUser.email,
                assignedStudents: existingTestIndex >= 0 ? tests[existingTestIndex].assignedStudents || [] : []
            };
            
            if (existingTestIndex >= 0) {
                tests[existingTestIndex] = test;
            } else {
                tests.push(test);
            }
            
            localStorage.setItem('tests', JSON.stringify(tests));
            localStorage.removeItem('editingTestId');
            alert('Тест успішно збережено!');
            goToTeacherDashboard();
        }

        function submitTest() {
            const test = getCurrentTest();
            const answers = [];
            let score = 0;
            let maxScore = 0;
            
            test.questions.forEach((question, qIndex) => {
                maxScore += question.points;
                let isCorrect = false;
                
                switch(question.type) {
                    case 'single':
                        const selectedAnswer = document.querySelector(`input[name="question-${qIndex}"]:checked`);
                        if (selectedAnswer) {
                            const answerIndex = parseInt(selectedAnswer.value);
                            isCorrect = question.answers
